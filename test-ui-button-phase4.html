<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Phase 4: UI Button Migration Demo</title>
    <style>
      body {
        font-family:
          system-ui,
          -apple-system,
          sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 2rem;
        /* Use CSS custom properties that respect dark/light mode */
        background: var(--ui-background-primary, #f9fafb);
        color: var(--ui-text-primary, #111827);
      }

      /* Dark mode override for body */
      @media (prefers-color-scheme: dark) {
        body {
          background: var(--ui-background-primary, #111827);
          color: var(--ui-text-primary, #f9fafb);
        }
      }

      .demo-section {
        background: var(--ui-background-secondary, white);
        color: var(--ui-text-primary, #111827);
        padding: 2rem;
        margin: 2rem 0;
        border-radius: 0.5rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      @media (prefers-color-scheme: dark) {
        .demo-section {
          background: var(--ui-background-secondary, #1f2937);
          color: var(--ui-text-primary, #f9fafb);
          box-shadow: 0 1px 3px rgba(255, 255, 255, 0.1);
        }
      }

      .demo-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin: 1rem 0;
      }

      .success-indicator {
        padding: 1rem;
        background: var(--ui-color-success-light, #d1fae5);
        border: 1px solid var(--ui-color-success, #10b981);
        border-radius: 0.375rem;
        color: var(--ui-color-success-dark, #065f46);
        margin: 1rem 0;
      }

      .architecture-info {
        background: var(--ui-color-primary-light, #eff6ff);
        border: 1px solid var(--ui-color-primary, #3b82f6);
        border-radius: 0.375rem;
        padding: 1rem;
        margin: 1rem 0;
        color: var(--ui-text-primary, #111827);
      }

      @media (prefers-color-scheme: dark) {
        .success-indicator {
          background: var(--ui-color-success-dark, #064e3b);
          color: var(--ui-color-success-light, #a7f3d0);
        }

        .architecture-info {
          background: var(--ui-color-primary-dark, #1e3a8a);
          color: var(--ui-color-primary-light, #dbeafe);
        }
      }

      .before-after {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        margin: 2rem 0;
      }

      .before,
      .after {
        padding: 1rem;
        border-radius: 0.375rem;
      }

      .before {
        background: var(--ui-color-warning-light, #fef3c7);
        border: 1px solid var(--ui-color-warning, #f59e0b);
        color: var(--ui-color-warning-dark, #92400e);
      }

      .after {
        background: var(--ui-color-success-light, #d1fae5);
        border: 1px solid var(--ui-color-success, #10b981);
        color: var(--ui-color-success-dark, #065f46);
      }

      @media (prefers-color-scheme: dark) {
        .before {
          background: var(--ui-color-warning-dark, #92400e);
          color: var(--ui-color-warning-light, #fde68a);
          border-color: var(--ui-color-warning, #f59e0b);
        }

        .after {
          background: var(--ui-color-success-dark, #064e3b);
          color: var(--ui-color-success-light, #a7f3d0);
          border-color: var(--ui-color-success, #10b981);
        }
      }

      code {
        background: #f3f4f6;
        padding: 0.2rem 0.4rem;
        border-radius: 0.25rem;
        font-family: 'Monaco', 'Menlo', monospace;
      }

      pre {
        background: var(--ui-background-tertiary, #f3f4f6);
        color: var(--ui-text-primary, #111827);
        padding: 1rem;
        border-radius: 0.375rem;
        overflow-x: auto;
        border: 1px solid var(--ui-border-primary, #e5e7eb);
      }

      @media (prefers-color-scheme: dark) {
        pre {
          background: var(--ui-background-tertiary, #1f2937);
          color: var(--ui-text-primary, #f9fafb);
          border-color: var(--ui-border-primary, #374151);
        }
      }

      .test-results {
        margin-top: 1rem;
        padding: 1rem;
        background: var(--ui-background-tertiary, #f3f4f6);
        border-radius: 0.375rem;
        border: 1px solid var(--ui-border-primary, #e5e7eb);
        color: var(--ui-text-primary, #111827);
      }

      @media (prefers-color-scheme: dark) {
        .test-results {
          background: var(--ui-background-tertiary, #1f2937);
          border-color: var(--ui-border-primary, #374151);
          color: var(--ui-text-primary, #f9fafb);
        }
      }
    </style>
  </head>
  <body>
    <h1>üöÄ Phase 4: UI Button Migration Demo</h1>
    <p>
      Testing the migration of UI Button to use our new efficient adoptedStyleSheets architecture
      from Phases 1-3.
    </p>

    <div class="success-indicator">
      <strong>‚úÖ Migration Successful!</strong> UI Button now uses StaticStylesheetMixin +
      DynamicStylesMixin for modern CSS delivery.
    </div>

    <div class="architecture-info">
      <h3>üèóÔ∏è New Architecture</h3>
      <p>
        <strong>StaticStylesheetMixin</strong>: Handles the base UI Button CSS with modern
        adoptedStyleSheets API
      </p>
      <p>
        <strong>DynamicStylesMixin</strong>: Ready for runtime theming and custom styling (future
        enhancement)
      </p>
      <p>
        <strong>Performance</strong>: Uses efficient O(1) duplicate detection and intelligent
        caching
      </p>
    </div>

    <div class="demo-section">
      <h2>üé® UI Button Variants</h2>
      <p>
        All styling now delivered via modern adoptedStyleSheets API with automatic fallback to
        &lt;style&gt; elements.
      </p>

      <div class="demo-grid">
        <ui-button>Default Button</ui-button>
        <ui-button variant="primary">Primary Button</ui-button>
        <ui-button variant="secondary">Secondary Button</ui-button>
        <ui-button variant="success">Success Button</ui-button>
        <ui-button variant="warning">Warning Button</ui-button>
        <ui-button variant="danger">Danger Button</ui-button>
        <ui-button variant="ghost">Ghost Button</ui-button>
      </div>
    </div>

    <div class="demo-section">
      <h2>üìè Size Variants</h2>
      <div class="demo-grid">
        <ui-button size="small" variant="primary">Small Button</ui-button>
        <ui-button variant="primary">Default Button</ui-button>
        <ui-button size="large" variant="primary">Large Button</ui-button>
      </div>
    </div>

    <div class="demo-section">
      <h2>üîÑ State Examples</h2>
      <div class="demo-grid">
        <ui-button variant="primary">Normal</ui-button>
        <ui-button variant="primary" disabled>Disabled</ui-button>
        <ui-button variant="primary" loading>Loading</ui-button>
      </div>
    </div>

    <div class="demo-section">
      <h2>üß™ Browser Developer Tools Testing</h2>
      <p>Open your browser's Developer Tools and inspect the buttons:</p>
      <ol>
        <li>
          <strong>Modern Browsers</strong>: Look for <code>adoptedStyleSheets</code> in the document
          object
        </li>
        <li><strong>Network Tab</strong>: CSS is no longer loaded as separate HTTP request</li>
        <li><strong>Performance</strong>: Faster initial render due to inline CSS delivery</li>
        <li><strong>Memory</strong>: Shared stylesheets across all button instances</li>
      </ol>

      <pre><code>// Test in browser console:
console.log('Document adoptedStyleSheets:', document.adoptedStyleSheets);
console.log('Length:', document.adoptedStyleSheets.length);

// Test button instance
const button = document.querySelector('ui-button');
console.log('Button component:', button);
console.log('Static stylesheet applied:', !!button.constructor.stylesheet);</code></pre>
    </div>

    <div class="demo-section">
      <h2>üìä Before vs After Comparison</h2>
      <div class="before-after">
        <div class="before">
          <h3>‚ùå Before (Old CSS Import)</h3>
          <ul>
            <li>Traditional CSS file import</li>
            <li>Browser handles CSS loading</li>
            <li>Separate HTTP request for styles</li>
            <li>No style sharing between instances</li>
            <li>Basic fallback support</li>
          </ul>
        </div>
        <div class="after">
          <h3>‚úÖ After (Modern Architecture)</h3>
          <ul>
            <li>AdoptedStyleSheets API with fallback</li>
            <li>Inline CSS delivery via JavaScript</li>
            <li>Zero additional HTTP requests</li>
            <li>Efficient style sharing</li>
            <li>Bulletproof error handling</li>
            <li>Future-ready for dynamic theming</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="demo-section">
      <h2>üéØ Technical Verification</h2>
      <p>Click the button below to test the integration and verify all functionality works:</p>
      <ui-button id="test-button" variant="primary">Click to Test Integration</ui-button>
      <div id="test-results" class="test-results"></div>
    </div>

    <script type="module">
      // Import the design tokens and base styles first
      import './src/style.css';
      // Import the UI Button component (this will use the new architecture)
      import './src/components/primitives/ui-button/index.js';

      // Test the integration when page loads
      document.addEventListener('DOMContentLoaded', () => {
        const testButton = document.getElementById('test-button');
        const testResults = document.getElementById('test-results');

        function runTests() {
          const results = [];

          // Test 1: Component is properly registered
          results.push(`‚úÖ Component registered: ${!!customElements.get('ui-button')}`);

          // Test 2: Static stylesheet is loaded
          const uiButton = document.querySelector('ui-button');
          results.push(`‚úÖ Static stylesheet defined: ${!!uiButton?.constructor?.stylesheet}`);

          // Test 3: Modern CSS delivery check
          const hasAdoptedStyleSheets = 'adoptedStyleSheets' in document;
          results.push(`‚úÖ Browser supports adoptedStyleSheets: ${hasAdoptedStyleSheets}`);

          if (hasAdoptedStyleSheets) {
            results.push(
              `‚úÖ Document adoptedStyleSheets count: ${document.adoptedStyleSheets.length}`
            );
          }

          // Test 4: Component functionality
          results.push(`‚úÖ Button is interactive: ${!testButton.disabled}`);
          results.push(
            `‚úÖ Accessibility methods available: ${typeof uiButton?.focus === 'function'}`
          );

          // Test 5: Mixin integration
          results.push(
            `‚úÖ AttributeManagerMixin: ${typeof uiButton?.getTypedAttribute === 'function'}`
          );
          results.push(
            `‚úÖ StaticStylesheetMixin: ${typeof uiButton?.applyStaticStylesheets === 'function'}`
          );

          // Test 6: Debug adoptedStyleSheets
          results.push(
            `üîç Document adoptedStyleSheets length: ${document.adoptedStyleSheets.length}`
          );
          if (document.adoptedStyleSheets.length > 0) {
            results.push(
              `üîç First stylesheet rules: ${document.adoptedStyleSheets[0].cssRules.length} rules`
            );
          }

          // Test 7: Check component's static stylesheet
          results.push(
            `üîç Component has static stylesheet: ${!!uiButton?.constructor?.stylesheet}`
          );
          if (uiButton?.constructor?.stylesheet) {
            try {
              const sheet = uiButton.constructor.stylesheet;
              results.push(`üîç Static stylesheet rules: ${sheet.cssRules.length} rules`);
            } catch (e) {
              results.push(`üîç Static stylesheet access error: ${e.message}`);
            }
          }

          testResults.innerHTML =
            '<h4>üß™ Integration Test Results:</h4>' +
            results.map((result) => `<div>${result}</div>`).join('');
        }

        // Run tests when button is clicked
        testButton.addEventListener('click', runTests);
        testButton.addEventListener('ui-button-click', (event) => {
          console.log('UI Button custom event:', event.detail);
        });

        // Run tests immediately
        setTimeout(runTests, 100);
      });

      // Performance monitoring
      const observer = new PerformanceObserver((list) => {
        for (const entry of list.getEntries()) {
          if (entry.name.includes('ui-button')) {
            console.log('UI Button performance:', entry);
          }
        }
      });
      observer.observe({ entryTypes: ['navigation', 'resource'] });
    </script>
  </body>
</html>
